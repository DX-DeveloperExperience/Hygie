--- # Rules config file
rules:
  - name: commitMessage
    enabled: true
    events:
      - Push
    options:
      regexp: '(feat|fix|docs)(\([a-z]+\))?:\s[^(]*(\(#[1-9][0-9]*(?:, #[1-9][0-9]*)*\))?$'
    onSuccess:
      - callback: LoggerRunnable
        args:
          type: info
          message: 'pattern match: 
            {{#data}}{{sha}} =
            Object: {{matches.1}} | Scope: {{matches.2}} | Issue: {{matches.3}}
            {{/data}}'
      - callback: LoggerRunnable
        args:
          type: info
          message: 'data will be sent to webhook...'
      - callback : WebhookRunnable
        args:
          url: 'https://webhook.site/0de43177-4119-448b-bcfe-e2f6a2845ce8'
          data: {
            user: 'bastien terrier',
            content: '{{#data}}{{sha}} =
            Object: {{matches.1}} | Scope: {{matches.2}} | Issue: {{matches.3}}
            {{/data}}'
          }
          config: {}
    onError:
      - callback: LoggerRunnable
        args:
          type: warn
          message: 'pattern does not match, commit name must begin with : "feat|fix|docs"! Check your commit message:
            {{#data}}
              > {{message}} (#{{sha}})
            {{/data}}
          '
  - name: branchName
    enabled: true
    events:
      - NewBranch
    options:
      regexp: (features|fix)\/.*
    onSuccess:
      - callback: LoggerRunnable
        args:
          type: info
          message: '{{data.branch}} is a good name!'
    onError:
      - callback: LoggerRunnable
        args:
          type: warn
          message: 'pattern does not match, branch name must begin with : "features|fix"!'
  - name: oneCommitPerPR
    enabled: true
    events:
      - Push
    onSuccess:
      - callback: LoggerRunnable
        args:
          type: info
          message: 'there is only on commit in this PR/MR/Push, ok'
    onError:
      - callback: LoggerRunnable
        args:
          type: warn
          message: 'more than one commit! A notification will be sent to the maintainer.'
      - callback : WebhookRunnable
        args:
          url: 'https://webhook.site/0de43177-4119-448b-bcfe-e2f6a2845ce8'
          data: {
            user: 'bastien terrier',
            content: 'More than one commmit !',
            commits: '{{#data.commits}}
              {{message}} (#{{id}})
            {{/data.commits}}
            ',
          }
          config: {
            headers: {
              Authorization: 'token 1234567890abcdef'
            }
          }
  - name: issueTitle
    enabled: true
    events:
      - NewIssue
    options:
      regexp: (add|fix)\s.*
    onSuccess:
      - callback: LoggerRunnable
        args:
          type: info
          message: '{{data.issueTitle}} is a correct issue title'
    onError:
      - callback: LoggerRunnable
        args:
          type: warn
          message: '{{data.issueTitle}} is not a correct issue title'
      - callback: CommentIssueRunnable
        args:
          comment: 'ping @bastienterrier'   
  - name: pullRequestTitle
    enabled: true
    events:
      - NewPR
    options:
      regexp: (WIP|PR)\s.*
    onSuccess:
      - callback: LoggerRunnable
        args:
          type: info
          message: '{{data.pullRequestTitle}} is a correct pull request title : {{data.pullRequestDescription}} (#{{data.pullRequestNumber}})'
    onError:
      - callback: LoggerRunnable
        args:
          type: warn
          message: '{{data.pullRequestTitle}} is not a correct pull request title : {{data.pullRequestDescription}} (#{{data.pullRequestNumber}})'
      - callback: CommentPullRequestRunnable
        args:
          comment: 'ping @bastienterrier'   
          
